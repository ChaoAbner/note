一些横向关注点可以模块化为特殊的类，这些类就是切面。

## AOP术语

描述切面的术语通常有：**通知、切点和连接点**。

### 通知（Advice）

​		将切面要完成的工作称为通知。Spring切面可以应用五种类型的通知。

- **前置通知 (Before)**

  目标方法被调用前调用通知功能。

- **后置通知 (After)**

  目标方法完成后调用通知功能，不关心方法的输出是什么。

- **返回通知 (After-returning)**

  目标方法成功执行后调用通知。

- **异常通知 (After-throwing)**

  在目标方法抛出异常后调用通知。

- **环绕通知 (Around)**

  通知包裹了被通知的方法，在被通知的方法调用前和调用后执行自定义的行为。



### 连接点（Join point)

​		连接点是在应用执行过程中能够插入切面的一个点。这个点可以是调用方法时、抛出异常时，甚至修改一个字段时。切面代码可以利用连接点插入到应用的正常流程之中，并添加新的行为。

### 切点（Poincut)

​		实际上，一个切面并不需要通知应用的所有连接点。切点有利于缩小切面所通知的连接点的范围。

### 引入（Introduction）

​		引入允许我们向现有的类添加新方法或属性。实现在无需修改这些现有的类的情况下，让他们具有新的行为或状态。

### 织入（Weaving）

​		把切面应用到目标对象并创建新的代理对象的过程。切面在指定的连接点被织入到对象中。在目标对象的生命周期里有多个点可以进行织入：

- 编译期
- 类加载期
- 运行期



### Spring对AOP的支持

Spring提供了4种类型的AOP支持：

- 基于代理的经典Spring AOP；
- 纯POJO切面；
- @AspectJ注解驱动的切面；
- 注入式AspectJ切面



## 通过切点来选择连接点

Spring借助AspectJ的切点表达式来定义Spring切面

![1568189328242](F:\typoraImg\1568189328242.png)

![1568189355668](F:\typoraImg\1568189355668.png)

### 编写切点

![1568189423179](F:\typoraImg\1568189423179.png)

### 在切点中选择bean

​		在perform方法执行时，限定bean的ID为`woodstock`

```java
execution(* concert.Performance.perform(..)) and bean('woodstock')
```

## 使用注解创建切面

Audience类：观看演出的切面

![1568189901443](F:\typoraImg\1568189901443.png)

使用AspectJ注解来表明这个类是一个切面。

可以看到注解中的切点表达式都重复了，为了解决这个问题，可以使用@Pointcut注解来定义一个可重用的切点。

![1568190070673](F:\typoraImg\1568190070673.png)

### 处理通知中的参数

![1568199410026](F:\typoraImg\1568199410026.png)

![1568199477309](F:\typoraImg\1568199477309.png)

在切点表达式中声明参数，这个参数传入到playTrack这个通知方法中。

