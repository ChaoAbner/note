# MongoDB总结

1. **索引结构：**

   B树，因为MongoDB是非关系型数据库，设计出来主要是用来单一查询。并不适合遍历查询。如果有多张表join的情况，因为B树的结构会导致效率很慢。

   MongoDB的索引**也符合最左匹配原则**。

   但是只是单一查询的话，可能查询的效率比B+树还高。可能O(1)的时间就找出来了。

   错误设计：

   ![1582169361906](F:\typoraImg\1582169361906.png)

   正确设计：

   ![1582169385302](F:\typoraImg\1582169385302.png)

2. **MongoDB和MySQL的区别**

   ![1582169975774](F:\typoraImg\1582169975774.png)

3. **MongoDB和Redis的区别**

   ![1582170022448](F:\typoraImg\1582170022448.png)

4. **MongoDB的优势**

   面向文档型存储，适合存储JSON格式的数据。

   支持分片，将数据集分布在多个数据中心。基于分片键创建数据区域

   支持聚合管道（Aggregation Pipeline）、全文搜索（Text Search）、地理空间查询（Geo）；

5. **MongoDB支持的数据类型**

   跟java类似

   ![1582170473397](F:\typoraImg\1582170473397.png)

   特有类型

   ![1582170519536](F:\typoraImg\1582170519536.png)

6. **如何执行事务/加锁？**

   mongodb`没有使用传统的锁或者复杂的带回滚的事务,因为它设计的宗旨是轻量,快速以及可预计的高性能.可以把它类比成`mysql mylsam`的自动提交模式.通过精简对事务的支持,性能得到了提升,特别是在一个可能会穿过多个服务器的系统里.

7. **索引类型**，**常见**

   复合索引(`Compound Indexes`)

   多键索引(`Multikey Indexes`)

   全文索引(`text Indexes`)

   Hash 索引(`Hash Indexes`)

8. **聚合**

   **MongoDB中聚合(aggregate)** 操作将来自多个document的value组合在一起，并通过对分组数据进行各种操作处理，并返回计算后的数据结果，主要**用于处理数据**(诸如统计平均值,求和等)。MongoDB提供三种方式去执行聚合操作：**聚合管道（aggregation pipeline）**、**Map-Reduce函数**以及**单一的聚合命令(count、distinct、group)**。**用于数据处理，可以适应于一些数据分析**

   ![1582174529299](F:\typoraImg\1582174529299.png)

   详情见https://juejin.im/post/5d40482ce51d4561c41fb79e

9. **Map-Reduce函数**

   MongoDB还提供map-reduce操作来执行聚合。 通常，**map-reduce操作有两个阶段**：**一个map阶段**，它处理每个文档并为每个输入文档发出一个或多个对象，以及**reduce阶段**组合map操作的输出。 可选地，map-reduce可以具有最终化阶段以对结果进行最终修改。 与其他聚合操作一样，map-reduce可以指定查询条件以选择输入文档以及排序和限制结果。

     Map-reduce**使用自定义JavaScript函数来执行映射和减少操作**，以及可选的finalize操作。 虽然自定义JavaScript与聚合管道相比**提供了极大的灵活性**，但通常，map-reduce比聚合管道**效率更低，更复杂**

   ![1582174595430](F:\typoraImg\1582174595430.png)

**10、允许空值null吗？**

​		空值null是不允许的。对于对象成员，是允许的。但是用户不能添加空值（null)到数据库集合中，因为null不是对象。用户可以添加空对象{}。

**12、什么是master或primary？**

​		备份集群中负责**处理所有写入操作**的成员。在一个备份集群中，当master失效的时候，一个另外的成员会编程master。

**13、什么是secondary 或者 slave?**

​		从当前的master上做复制数据的操作。

**14、分片（sharding）和复制（replication）是怎样工作的？**

​		每个分片是一个分区数据的逻辑集合。分片可能由单一服务器或者集群组成。

**15、数据什么时候才会扩展到多个分片里?**

​		MongoDB的分片是基于区域的。所以**一个集合中的所有对象都被存放到一个块**中。只有当存在多于一个块的时候，才会有多个分片获取数据的选项。

**16、如果在一个分片停止或者很慢的时候，我发起一个查询会怎么样？**

​		如果一个分片停止了，除非传设置了“partial”选项，否则查询会返回一个错误。如果一个分片很慢，MongoDB会等待他的响应。

