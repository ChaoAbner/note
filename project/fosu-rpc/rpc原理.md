## 什么是RPC

RPC（Remote Procedure Call）远程过程调用，通过名字可以知道它是远程调用而非本地调用。

## 为什么要RPC

因为不同的服务器，它们提供的方法不在同一个内存空间，所以需要网络编程去传递调用的方法以及对应的参数，并且方法调用的结果也通过网络请求去返回给调用方。

简单地说，RPC可以帮助我们调用远程计算机上的某个服务的方法，这过程就像调用本地方法一样简单，不需要我们去了解网络编程的细节。

## 设计RPC需要考虑什么

底层传输协议（TCP、UDP）

序列化协议（kryo，hession..)

## RPC的原理

RPC的核心功能由下面的六个部分实现：

1. 客户端（服务消费端）：调用远程方法的一端。
2. 客户端Stub（桩）：其实就是代理类，代理类做的事情就是把你需要调用的方法、参数，类等信息传输到服务端。
3. 网络传输：网络传输作为连接客户端和服务端的通道，用于传输调用的方法、其他相关信息以及调用返回的结果等。网络传输的方式有很多种，比如Netty。
4. 服务端Stub（桩）：服务端Stub就不是代理类了。其实理解为桩也不是很好，这里的服务端Stub其实就是接受到客户端执行方法的请求后，去执行指定的方法然后返回结果给客户端的类。
5. 服务端（服务提供者）：提供远程方法的一端。

原理图如下：

![image-20210220102509584](http://img.fosuchao.com/image-20210220102509584.png)

1. 服务消费端（client）以本地调用的方式调用远程服务； 
2. 客户端 Stub（client stub） 接收到调用后负责将方法、参数等组装成能够进行网络传输的消 息体（序列化）： RpcRequest ； 
3. 客户端 Stub（client stub） 找到远程服务的地址，并将消息发送到服务提供端；
4.  服务端 Stub（桩）收到消息将消息反序列化为Java对象: RpcRequest ； 
5.  服务端 Stub（桩）根据 RpcRequest 中的类、方法、方法参数等信息调用本地的方法； 
6. 服务端 Stub（桩）得到方法执行结果并将组装成能够进行网络传输的消息体： RpcResponse （序列化）发送至消费方；
7. 客户端 Stub（client stub）接收到消息并将消息反序列化为Java对象: RpcResponse ，这样也 就得到了最终结果。over

具体过程如下：

![image-20210220103742157](http://img.fosuchao.com/image-20210220103742157.png)