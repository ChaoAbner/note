# MongoDB权威指南



## 索引

### 简介

​		如果我们查询时只需要查询一个键，这个时候可以添加一个索引来加快查询的速度。（1为升序，-1为降序）

![1575123563042](F:\typoraImg\1575123563042.png)

​		对于同一个集合，索引只需要创建一次，不用重复创建。

​		或者建立多个索引（前后顺序有影响）

![1575123715395](F:\typoraImg\1575123715395.png)

​		当我们要通过一个键比如时间来排序查询的时候，就会进行全表扫描，这个时候，我们需要建立多个索引来加快查询速度。

**注意事项**

![1575124374201](F:\typoraImg\1575124374201.png)

#### 扩展索引

​		如果我们要经常查询用户的最新状态（时间），那么最好把`date`放前面，来改变索引的顺序，有效减少内存的交换。

**建立索引需要考虑的问题**

![1575124939247](F:\typoraImg\1575124939247.png)

#### 索引内嵌文档的键

![1575124981682](F:\typoraImg\1575124981682.png)

#### 为需要排序的键创建索引

![1575125062271](F:\typoraImg\1575125062271.png)

### 唯一索引

![1575125578201](F:\typoraImg\1575125578201.png)

Object(id)就是一个唯一索引，有一个不同点就是不能删除



#### 地理空间索引



### 聚合

#### count

![1575128675203](F:\typoraImg\1575128675203.png)

#### distinct

找出给定键的所有**不同的值**（数组）。使用时需要**指定集合和键**。

![1575128889804](F:\typoraImg\1575128889804.png)

#### group

跟SQL中的group by差不多，聚合多个组内的文档，产生一个结果文档。



#### MapDeduce

​		上面三个聚合能做的事情都能做。

​		缺点是速度，group不是很快，而MapReduce更慢。**绝不要用在实时环境中**，要用后台任务来运行MapDeduce，将创建一个保存结果的集合，可以对这个集合进行实时查询。

**示例：**

##### 找出集合中的所有键



##### 网页分类



##### MapReduce的键

mapreduce

map

reduce

finalize：函数。将reduce的结果发送给这个键，进行处理的最后异步

keeptemp：布尔值。连接关闭时临时结果的集合是否保存

output： 字符串。结果集合的名字。隐含着keeptemp：true。

query： 文档。在发往map前，用指定条件进行过滤文档。

sort：文档。在发往map前，给文档排序（跟limit一起使用很有用）

limit：整数。发往map函数的文档数量的上限。

scope：文档。js中要用到的变量。

verbose：布尔值。是否产生更加详尽的服务器日志。

![1575172971868](F:\typoraImg\1575172971868.png)



## 集群

Mongodb的集群架构如下：

